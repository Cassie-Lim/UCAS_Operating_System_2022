# OS作业10

<center>
    林孟颖 2020K8009915008
</center>
## 10.1 

现有一个内存空间分配器，采用伙伴算法。假设物理内存总共 64 KB，

1) 请给出第一级的一对伙伴块的起始地址
2) 请给出第二级的二对伙伴块的起始地址
3) 地址 0xa700，已知它位于第 7 级伙伴块中，请问该块的伙伴块的起始地址

---

> 伙伴算法的位图介绍：
>
> [(9条消息) 伙伴算法---位图_haidao1101的博客-CSDN博客_伙伴算法 位图](https://blog.csdn.net/haidao1101/article/details/89487979)
>
> [(9条消息) 伙伴（buddy）算法及位图_Unique-You的博客-CSDN博客_buddy算法 图解](https://blog.csdn.net/qq_22238021/article/details/80208630#commentBox，非常感谢；)

 一块大小默认512B，64KB对应$2^7$块，即需要8个级别（含第0级的一整块内存）。

 1）第一级的一对伙伴块起始地址：`0x0000 ~ 0x7fff `, `0x8000 ~ 0xffff`;

 2）第二级的两对伙伴块起始地址：`0x0000 ~ 0x3fff `, `0x4000 ~ 0x7fff`;`0x8000 ~ 0xbfff `, `0xc000 ~ 0xffff`;

3）第 7 级伙伴块地址为`512B`对齐的，即最低12位为0，故上述地址所在块地址为`0xa000`，又因为一对伙伴块中地址处于低位的那一块地址应该为512B的偶数倍，得知该块在pair中是地址较低的一块，其伙伴块地址为`0xb000`。

32kb = 2^5 * 2^13

## 10.2 

假设一个程序对其地址空间中虚页的访问序列为0,1,2，…,511,422,0,1,2,…,511，333,0,1,2,…，即访问一串连续地址（页0到页511）后会随机访问一个页（页422或页333），且这个访问模式会一直重复。请分析说明：

（1）假设操作系统分配给该程序的物理页框为500个，那么，LRU，Second Chance和FIFO这三种算法中哪一个会表现较好（即提供较高的缓存命中率），或是这三种算法都表现不佳？为什么？

---

- 对于LRU算法：

  - ROUND1：由于物理页框个数为500，而一个访问周期内会访问512+1页，且前512页皆不相同，则前512次访问皆不命中；第513页访问的是页422或页333，此时已经载入的页数为`11~511`，故会命中；

  - ROUND2~：由于前一轮最后一次访问页时访问了422（或者333），其会被调至替换链表表尾，则此轮在前512次访问中访问422（或者333）时会命中，且同ROUND1，第513次访问一定命中。

  - 假设一共进行了N轮，则命中率为：
    $$
    \frac{1+(N-1)\times 2}{N\times 513}
    $$

- 对于Second Chance算法：

  ROUND1 情况和LRU相同，但命中后不会再将页结点转移至链表尾，而是将之R位置1，若命中则将R位清零，同时放在表尾，故此时其效果相当于LRU算法，只是将命中页替换到表尾的时机不同。故总共命中率也为：
  $$
  \frac{1+(N-1)\times 2}{N\times 513}
  $$
  

- 对于FIFO算法：

  ROUND1 情况和LRU相同，但命中后不会再将页结点转移至链表尾，也不会对之做特殊标记，由于每轮按序访问512个不同页、内存只允许装载500页，故后续回合访问相当于重开，每轮皆只命中一次（访问第513个页时），进行N轮，总命中率为：
  $$
  \frac{1}{513}
  $$

注意到此时三种算法效率皆不高，原因是每轮访问的页数几乎都不相同，且每轮访问的页数大于内存可容纳的页数，导致下一轮按照相同顺序访问时上一轮访问的页基本已经被替换出内存。
